---
import { Image } from 'astro:assets';
import { IMAGE_URL } from '../consts';
import BaseLayout from "../layouts/BaseLayout.astro";
import { getLastPost, getLastCategoryPost, getWeekEvent, getLatesPosts, getTopPosts, getPreviousMonthPosts } from '../lib/api';
import FormattedDate from '../components/FormattedDate.astro';

const today = new Date();

const LastPost = await getLastPost();
const LastCategoryPost = await getLastCategoryPost();
const WeekEvent = await getWeekEvent();
const LastePosts = await getLatesPosts(10);
const TopPosts = await getTopPosts();
const PreviousMonthPosts = await getPreviousMonthPosts();
---
<style>
	a{
		text-decoration: none;
	}
</style>
<BaseLayout>
	<!-- Main Post Section Start -->
	<div class="container-fluid py-5">
		<div class="container py-5">
			<div class="row g-4">
				
				<div class="col-lg-7 col-xl-8 mt-0">
					<div class="position-relative overflow-hidden rounded">
						<img src={`${IMAGE_URL}${LastPost.image}`} class="img-fluid rounded img-zoomin w-100" alt={LastPost.title_en} />
						<div class="d-flex bg-dark justify-content-start p-2 position-absolute flex-wrap w-100" style="bottom: 0; left: 0;">
							<a class="text-white me-3 link-hover">
								<i class="fa fa-clock"></i> 
								<span style="margin-left: 3px;">
									{LastPost.reading_time} {LastPost.reading_time > 1 ? ' mins ': ' min ' } read
								</span>
							</a>
						</div>
					</div>
					<div class="border-bottom py-3">
						<a 
						href={`blog${LastPost.absolute_url}`} 
						class="display-6 text-dark mb-0 link-hover">{LastPost.title_en}</a>
					</div>
					
				</div>
					
				<div class="col-lg-5 col-xl-4">
						
					{  
						LastCategoryPost
						&&
						<div class="bg-light rounded p-4 pt-0">
							
							<div class="mb-4 pt-4">
								<h2 class="text-dark fw-bold fs-2">Latest articles by category</h2>
							</div>
							<div class="row g-4">
								{
									LastCategoryPost.map((post: any) => (
										<div class="col-12" title={post.title_en}>
											<div class="row g-4 align-items-center">
												<div class="col-6">
													<div class="overflow-hidden rounded">
														<img src={`${IMAGE_URL}${post.image}`} class="img-zoomin img-fluid rounded" style="width: 100%; height:100px;" alt={post.title_en}>
													</div>
												</div>
												<div class="col-6">
													<div class="features-content d-flex flex-column">
														<small class="text-uppercase">{post.category.name}</small>
														<a href={`blog${post.absolute_url}`} class="h6">{post.title_en.slice(0, 35)}...</a>
														<small>
															<i class="fa fa-clock"></i>
															<span class="me-2" style="margin-left: 3px;">
																{post.reading_time} { post.reading_time > 1 ? ' mins ': ' min ' } read
															</span> 
														</small>
													</div>
												</div>
											</div>
										</div>
									))
								}
							</div>
						
						</div>
					}
				</div>
			</div>
		</div>
	</div>
	<!-- Main Post Section End -->

	<!-- Latest News Start -->
	<div class="container-fluid latest-news py-5">
		<div class="container py-5">
			<h2 class="mb-4">Most recents</h2>
			<div class="latest-news-carousel owl-carousel owl-theme">
				{
					LastePosts.map((post: any) => (
						<div class="latest-news-item" title={post.title_en}>
							<div class="bg-light rounded">
								<div class="rounded-top overflow-hidden">
									<img src={`${IMAGE_URL}${post.image}`} class="img-zoomin img-fluid rounded-top" style="width: 100%; height: 200px;" alt={post.title_en}>
								</div>
								<div class="d-flex flex-column p-4">
									<a href={`blog${post.absolute_url}`} class="h4">{post.title_en.slice(0, 30)}</a>
									<div class="d-flex justify-content-between">
										<a href="#" class="small text-body link-hover">by { post.author.username }</a>
										<small class="text-body d-block">
											<i class="fas fa-calendar-alt me-1"></i>
											<span style="margin-left: 3px;">
												{
													post.posted.toDateString == today.toDateString() ?
													'Today'
													:
													<FormattedDate date={post.posted} />
												}	
											</span>
										</small>
									</div>
								</div>
							</div>
						</div>
					))
				}
			</div>
		</div>
	</div>
	<!-- Latest News End -->
	
	<!-- Most Populer News Start -->
	<div class="container-fluid latest-news py-5">
		<div class="container py-5">
			<div class="tab-class mb-4">
				<div class="row">
					<div class="col-12 row mb-5">
						<div class="mb-4">
							<h2 class="my-4">Popular articles</h2>
						</div>

						<div class="latest-news-carousel owl-carousel owl-theme">
							{
								TopPosts.map((post: any) => (
								<div class="latest-news-item" title={post.title_en}>
									<div class="bg-light rounded">
										<div class="rounded-top overflow-hidden">
											<img src={`${IMAGE_URL}${post.image}`} class="img-zoomin img-fluid rounded-top w-100" style="height: 210px !important;" alt={post.title_en}>
										</div>
										<div class="d-flex flex-column p-4">
											<a href={`blog${post.absolute_url}`} class="h4">{post.title_en.slice(0, 30)}</a>
											<div class="d-flex justify-content-between">
												<a href="#" class="small text-body link-hover">by { post.author.username }</a>
												<small class="text-body d-block">
													<i class="fas fa-calendar-alt me-1"></i> 
													<span style="margin-left: 3px;">
														{
															post.posted.toDateString == today.toDateString() ?
															'Today'
															:
															<FormattedDate date={post.posted} />
														}	
													</span>
												</small>
											</div>
										</div>
									</div>
								</div>
								))
							}
						</div>
					</div>

					{
						PreviousMonthPosts
						&&
						<div class="col-12 row mt-5">
                        <div class="border-bottom mb-4">
                            <h2 class="my-4">Last month's articles</h2>
                        </div>

                        <div class="latest-news-carousel owl-carousel owl-theme">
							{
								PreviousMonthPosts.map((post: any) => (
								<div class="latest-news-item" title={post.title_en}>
									<div class="bg-light rounded">
										<div class="rounded-top overflow-hidden">
											<img src={`${IMAGE_URL}${post.image}`} class="img-zoomin img-fluid rounded-top w-100" style="height: 210px !important;" alt={post.title_en}>
										</div>
										<div class="d-flex flex-column p-4">
											<a href={`blog${post.absolute_url}`} class="h4">{post.title_en.slice(0, 30)}</a>
											<div class="d-flex justify-content-between">
												<a href="#" class="small text-body link-hover">by { post.author.username }</a>
												<small class="text-body d-block">
													<i class="fas fa-calendar-alt me-1"></i> 
													<span style="margin-left: 3px;">
														{
															post.posted.toDateString == today.toDateString() ?
															'Today'
															:
															<FormattedDate date={post.posted} />
														}	
													</span>
												</small>
											</div>
										</div>
									</div>
								</div>
								))
							}
						</div>
                    </div>
					}
					
				</div>
			</div>
		</div>
	</div>
	<!-- Most Populer News End -->
</BaseLayout>
